<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Chess Timer Responsive Pro</title>
    <style>
      :root {
        --bg-color: #0f0f0f;
        --p1-color: #1e3a8a; /* Biru Gelap */
        --p2-color: #7f1d1d; /* Merah Gelap */
        --accent: #059669;
        --text: #ffffff;
        --panel-bg: #18181b;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          sans-serif;
        background-color: var(--bg-color);
        color: var(--text);
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh; /* Kunci tinggi layar */
        width: 100vw;
        overflow: hidden;
      }

      /* Toolbar Atas */
      .settings-bar {
        background: var(--panel-bg);
        padding: 10px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        border-bottom: 1px solid #333;
        z-index: 10;
      }

      .input-group {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.8rem;
      }

      input,
      select,
      button {
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #3f3f46;
        background: #27272a;
        color: white;
        font-size: 0.9rem;
      }

      button {
        background: var(--accent);
        cursor: pointer;
        border: none;
        font-weight: bold;
      }
      button:active {
        transform: scale(0.95);
      }

      /* Area Utama (Timer) */
      .game-container {
        display: flex;
        flex: 1; /* Mengambil sisa ruang antara header dan log */
        min-height: 0;
        flex-direction: row; /* Default: Sampingan (Desktop) */
      }

      /* Responsif HP: Timer Atas-Bawah */
      @media (max-width: 768px) {
        .game-container {
          flex-direction: column;
        }

        /* Memutar area Pemain 1 agar menghadap lawan */
        #zone1 {
          transform: rotate(180deg);
        }

        .time-display {
          font-size: 5rem !important;
        }

        /* Memastikan label "PEMAIN 1" juga terbaca benar olehnya */
        #zone1 span {
          margin-top: 10px;
        }
      }

      /* Memperhalus tampilan zona agar teks tetap di tengah saat diputar */
      .player-zone {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: background 0.2s;
        -webkit-tap-highlight-color: transparent;
        width: 100%; /* Pastikan lebar penuh saat vertikal */
      }

      #zone1 {
        background-color: var(--p1-color);
      }
      #zone2 {
        background-color: var(--p2-color);
      }

      .time-display {
        font-size: 7rem;
        font-weight: 800;
        font-family: "Monaco", monospace;
        margin: 10px 0;
      }

      .active {
        filter: brightness(1.3);
        z-index: 2;
        box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.5);
      }
      .inactive {
        opacity: 0.25;
        filter: grayscale(0.5);
      }
      .low-time {
        color: #fbbf24;
        animation: pulse 0.5s infinite;
      }

      @keyframes pulse {
        50% {
          opacity: 0.7;
        }
      }

      /* Panel Log Bawah */
      .log-container {
        height: 180px; /* Tinggi dikunci agar tidak menutup timer */
        background: #000;
        border-top: 2px solid #27272a;
        display: flex;
        flex-direction: column;
      }

      .log-header {
        padding: 8px 15px;
        background: #18181b;
        font-size: 0.75rem;
        display: flex;
        justify-content: space-between;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: #a1a1aa;
      }

      #moveLog {
        flex: 1;
        overflow-y: auto;
        padding: 0;
        margin: 0;
        list-style: none;
      }

      .log-item {
        display: grid;
        grid-template-columns: 40px 1fr 1fr 80px;
        padding: 10px 15px;
        border-bottom: 1px solid #18181b;
        font-size: 0.85rem;
      }

      .p1-tag {
        color: #60a5fa;
        font-weight: bold;
      }
      .p2-tag {
        color: #f87171;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="settings-bar">
      <select id="modeSelect" onchange="toggleIncInput()">
        <option value="normal">Normal</option>
        <option value="increment">Increment</option>
      </select>
      <div class="input-group">
        <input
          type="number"
          id="baseMins"
          value="5"
          min="1"
          style="width: 50px"
        />
        <span>Min</span>
      </div>
      <div id="incInput" style="display: none" class="input-group">
        <input
          type="number"
          id="incSecs"
          value="3"
          min="0"
          style="width: 45px"
        />
        <span>Sec</span>
      </div>
      <button onclick="initGame()">Reset</button>
      <button id="mainBtn" onclick="togglePlay()" style="background: #2563eb">
        Mulai
      </button>
    </div>

    <div class="game-container">
      <div id="zone1" class="player-zone" onclick="handleTap(1)">
        <span style="font-size: 0.9rem; font-weight: bold; opacity: 0.8"
          >PEMAIN 1</span
        >
        <div id="disp1" class="time-display">05:00</div>
      </div>

      <div id="zone2" class="player-zone" onclick="handleTap(2)">
        <span style="font-size: 0.9rem; font-weight: bold; opacity: 0.8"
          >PEMAIN 2</span
        >
        <div id="disp2" class="time-display">05:00</div>
      </div>
    </div>

    <div class="log-container">
      <div class="log-header">
        <span>Riwayat Langkah</span>
        <span id="moveCount">Total: 0</span>
      </div>
      <ul id="moveLog"></ul>
    </div>

    <script>
      let t1,
        t2,
        timer,
        activePlayer = null,
        isRunning = false,
        moveCounter = 0,
        lastTime = 0;
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      function playSound(f, d) {
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.frequency.value = f;
        g.gain.value = 0.05;
        o.connect(g);
        g.connect(audioCtx.destination);
        o.start();
        o.stop(audioCtx.currentTime + d);
      }

      function toggleIncInput() {
        document.getElementById("incInput").style.display =
          document.getElementById("modeSelect").value === "increment"
            ? "flex"
            : "none";
      }

      function initGame() {
        clearInterval(timer);
        t1 = t2 = document.getElementById("baseMins").value * 60;
        activePlayer = null;
        isRunning = false;
        moveCounter = 0;
        document.getElementById("mainBtn").textContent = "Mulai";
        document.getElementById("moveLog").innerHTML = "";
        document.getElementById("moveCount").textContent = "Total: 0";
        updateUI();
      }

      function updateUI() {
        document.getElementById("disp1").textContent = format(t1);
        document.getElementById("disp2").textContent = format(t2);
        document.getElementById("zone1").className =
          `player-zone ${activePlayer === 1 ? "active" : activePlayer === null ? "" : "inactive"}`;
        document.getElementById("zone2").className =
          `player-zone ${activePlayer === 2 ? "active" : activePlayer === null ? "" : "inactive"}`;
        if (t1 <= 10)
          document.getElementById("disp1").classList.add("low-time");
        if (t2 <= 10)
          document.getElementById("disp2").classList.add("low-time");
      }

      function format(s) {
        return `${Math.floor(s / 60)
          .toString()
          .padStart(2, "0")}:${(s % 60).toString().padStart(2, "0")}`;
      }

      function togglePlay() {
        if (audioCtx.state === "suspended") audioCtx.resume();
        if (isRunning) {
          clearInterval(timer);
          isRunning = false;
          document.getElementById("mainBtn").textContent = "Lanjutkan";
        } else {
          if (!activePlayer) activePlayer = 1;
          lastTime = activePlayer === 1 ? t1 : t2;
          isRunning = true;
          document.getElementById("mainBtn").textContent = "Pause";
          timer = setInterval(tick, 1000);
        }
      }

      function tick() {
        if (activePlayer === 1) {
          t1--;
          if (t1 <= 10) playSound(800, 0.05);
          if (t1 <= 0) end(2);
        } else {
          t2--;
          if (t2 <= 10) playSound(800, 0.05);
          if (t2 <= 0) end(1);
        }
        updateUI();
      }

      function handleTap(id) {
        if (!isRunning || activePlayer !== id) return;
        moveCounter++;
        playSound(400, 0.03);

        const current = id === 1 ? t1 : t2;
        const inc =
          document.getElementById("modeSelect").value === "increment"
            ? parseInt(document.getElementById("incSecs").value)
            : 0;

        addLog(id, moveCounter, format(current), lastTime - current);

        if (id === 1) t1 += inc;
        else t2 += inc;
        activePlayer = id === 1 ? 2 : 1;
        lastTime = activePlayer === 1 ? t1 : t2;
        updateUI();
      }

      function addLog(p, m, rem, dur) {
        const li = document.createElement("li");
        li.className = "log-item";
        li.innerHTML = `<span>#${m}</span><span class="${p === 1 ? "p1-tag" : "p2-tag"}">P${p}</span><span>Sisa: ${rem}</span><span style="color:#71717a">${dur}s</span>`;
        const log = document.getElementById("moveLog");
        log.insertBefore(li, log.firstChild);
        document.getElementById("moveCount").textContent = `Total: ${m}`;
      }

      function end(p) {
        clearInterval(timer);
        playSound(200, 1);
        alert(`Pemain ${p} Menang!`);
        initGame();
      }

      window.onkeydown = (e) => {
        if (e.code === "Space") handleTap(1);
        if (e.code === "Enter") handleTap(2);
      };

      initGame();
    </script>
  </body>
</html>
